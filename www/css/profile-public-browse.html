<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Social Motives Template</title>

<meta name="viewport" content="width=640, user-scalable=yes, target-densitydpi=device-dpi,  minimum-scale=0.5, maximum-scale=0.5"/>
<!--

-->
  <style>
        #loading {
            width: 100%;
            height: 100%;
            top: 0px;
            left: 0px;
            position: fixed;
            display: block;
            opacity: .7;
            background-color: #000;
            z-index: 99;
            text-align: center;
        }
   
        #loading img {
            position: absolute;
            top: 380px;
            left: 320px;
            z-index: 100;
        }
        #loaderImage {
            position: absolute;
            top: 380px;
            left: 240px;
            z-index: 100;
        }

    </style>

<script>
localStorage.setItem("lp", localStorage.getItem('tp'));
localStorage.setItem("tp", "profile-public-browse");
var lp=localStorage.getItem('lp');
var id= localStorage.getItem('id');
var pid= localStorage.getItem('pid');

$(document).ready(function() {
var pid= localStorage.getItem('pid');
var id= localStorage.getItem('id');
function setview()
{

	var request = $.ajax({
			url: "http://54.186.32.195/actions.php?task=setview&id="+id,
			type: "post",
			data: '&val=' + pid
		});

	// callback handler that will be called on success
	request.done(function (response, textStatus, jqXHR)
	{
		// response == 0 - Successful
	
		
	});

	// callback handler that will be called on failure
	request.fail(function (jqXHR, textStatus, errorThrown)
	{
		// log the error to the console
		console.error(
			"The following error occured: "+
			textStatus, errorThrown
		);
					
		errorMsg("Problem with updating. Try again later.", 3000);
		return false;

	});	
	};
	setview();
// setview(pid);
    var weblink = 'http://54.186.32.195/preparepublicbrowse.php?id='+id+'&pid='+pid;
	
	 $.getJSON(weblink+"&jsoncallback=?", function(data){
	
       $("div.pro_browse_photo img").attr('src','http://54.186.32.195/'+data.picture)
// 		
       

		$("div.button.cnct").attr('onclick', 'localStorage.setItem("to","'+data.pid+'");localStorage.setItem("from","'+id+'");localStorage.setItem("subject","'+""+'");localStorage.setItem("sm_id","'+data.sm_id+'"); changePage("message_compose");');
 		
 		
 		
         $("div.motive_paper p").html(data.motive)  
         	if(data.blocked == 1){
         	$('div.button.block').html('<a href="#" onclick="unblock(' + data.pid + ');">Unblock</a>');
         	}
         	else{
         	$('div.button.block').html('<a href="#" onclick="block(' + data.pid + ');">Block</a>');
         	}
    		if(data.bFriends != "friends"){
    											$('div.pro_browse_photo').addClass('bubble3').attr('data-content','NF');

    		// if(data.bFriends == "Pending"){
// 				$('div.button.friend').html('<a href="#">Friend Request Sent</a>');
// 
//     		}
    		// else{
										//$('<td><a href="#" onclick="addFriend(' + data.pid + ');"><div class="button add">Add Friend</div></a></td>');
																				$('div.button.friend').html('<a href="#" onclick="addFriend3(' + data.pid + ');">Add Friend</a>');

									// }
									}
									

									if(data.bFriends == "friends"){
									$('div.pro_browse_photo').addClass('bubble2').attr('data-content','F');
										//$('<td><a href="#" onclick="delFriend(' + data.pid + ');"><div class="button del">Unfriend</div></a></td>');
																				$('div.button.friend').html('<a href="#" onclick="delFriend(' + data.pid + ');">Unfriend</a>');

									}
									 if(data.status == 0){
 		 									$('div.pro_browse_photo').addClass('bubble4').attr('data-content','O');

 		 $("#hdr_title").html(data.sm_id+" - OFFLINE - "+data.dist+" miles away")
 		 }
 		 else{
 		 $("#hdr_title").html(data.sm_id+" - "+data.dist+" miles away")
 		 }
									$('div.button.friend').toggle();
			// if(!data.bFriends || data.bFriends == "no"){
// 				//echo '<td><a href="#" onclick="addFriend(' . $id . ');"><div class="button add">Add Friend</div></a></td>';
// 				$('<td><a href="#" onclick="addFriend(' + data.pid + ');"><div class="button add">Add Friend</div></a></td>').insertAfter("td.spacer:first")
// 			}
// 			if(data.bFriends == "Pending"){
// 			$('<td><div class="button">Friend Request Sent</div></td>').insertAfter("td.spacer:first")
// 			}
// 			if(data.bFriends == "friends"){
// 								$('<td><a href="#" onclick="delFriend(' + data.pid + ');"><div class="button del">Unfriend</div></a></td>').insertAfter("td.spacer:first")
// 
// 			}
			
			tabledata="";
            tabledata=tabledata+"<tr><td>Gender:</td><td>"+data.gender+"</td></tr>"
			if(data.presence_res ==1){
			tabledata=tabledata+"<tr><td>Residence:</td><td>"+data.residence+"</td></tr>"
			}
			if(data.presence_rel ==1 && data.relationship == 1){
			tabledata=tabledata+"<tr><td>Relationship:</td><td>Single</td></tr>"
			}
			else if(data.presence_rel ==1 && data.relationship == 2){
			tabledata=tabledata+"<tr><td>Relationship:</td><td>Married</td></tr>"
			}
            else if(data.presence_rel ==1 && data.relationship == 0){
                tabledata=tabledata+"<tr><td>Relationship:</td><td>N/A</td></tr>"
            }
            else if(data.presence_rel ==1 && data.relationship == 3){
                tabledata=tabledata+"<tr><td>Relationship:</td><td>Taken</td></tr>"
            }
			if(data.presence_occ ==1){
			tabledata=tabledata+"<tr><td>Occupation:</td><td>"+data.occupation+"</td></tr>"
			}
			
			$("table.pro_pub_top:first").html(tabledata)
			table2data=""
			if(data.presence_til ==1){
			
			table2data=table2data+"<tr><td>Loves to do:</td><td>"+data.things_i_like+"</td></tr>"
			//alert(table2data);
			$("table.pro_pub_top:eq(1)").html(table2data)
			}
			 $("table.pro_pub_locations").append(data.checkin)
 $("#loading").toggle();
          
      });


});


	
	

function addFriend3(val)
{
  function onConfirm(button) {
  if (button==1)
   {
	var request = $.ajax({
			url: "http://54.186.32.195/actions.php?task=add_friend&id="+id,
			type: "post",
			data: '&val=' + val
		});

	// callback handler that will be called on success
	request.done(function (response, textStatus, jqXHR)
	{
		// response == 0 - Successful
		if(response == "0")
		{
		
				 $('div.button.friend').html('<a href="#">Friend Requested</a>');

			// refresh page
			//changePage('profile-public-browse');
			return true;
		}
		if(response == "3")
		{
		
		//alert("hello");
				 $('div.button.friend').html('<a href="javascript:delFriend(' + val + ');">Unfriend</a>');

			// refresh page
			//changePage('profile-public-browse');
			return true;
		}
		// response == 1 - Unknown error
		if(response == "1" || response == "-1")
		{
			errorMsg("Problem with updating. Try again later.", 3000);
			return false;
		}
	});

	// callback handler that will be called on failure
	request.fail(function (jqXHR, textStatus, errorThrown)
	{
		// log the error to the console
		console.error(
			"The following error occured: "+
			textStatus, errorThrown
		);
					
		errorMsg("Problem with updating. Try again later.", 3000);
		return false;

	});	
	}
	else{
	r=1;
	}
  }
 navigator.notification.confirm(
            'Send friend request to this user?',  // message
            onConfirm,              // callback to invoke with index of button pressed
            'Friend Request',            // title
            'Confirm,Cancel'          // buttonLabels
        );
//  var r=confirm("Send friend request to this user?");
 
}

function delFriend(val)
{
   function onConfirm(button) {
 var r=confirm("Are you sure you want to unfriend this user?");
 if (button==1)
   {
	var request = $.ajax({
			url: "http://54.186.32.195/actions.php?task=del_friend&id="+id,
			type: "post",
			data: '&val=' + val
		});

	// callback handler that will be called on success
	request.done(function (response, textStatus, jqXHR)
	{
		// response == 0 - Successful
		if(response == "0")
		{
						 $('div.button.friend').html('<a href="javascript:addFriend3(' + val + ');">Add Friend</a>');

			// refresh page
			//changePage('profile-public-browse');
			return true;
		}
		// response == 1 - Unknown error
		if(response == "1" || response == "-1")
		{
			errorMsg("Problem with updating. Try again later.", 3000);
			return false;
		}
	});

	// callback handler that will be called on failure
	request.fail(function (jqXHR, textStatus, errorThrown)
	{
		// log the error to the console
		console.error(
			"The following error occured: "+
			textStatus, errorThrown
		);
					
		errorMsg("Problem with updating. Try again later.", 3000);
		return false;

	});	
	}
	else{
	r=1;
	}
	}
	 navigator.notification.confirm(
            'Are you sure you want to unfriend this user?',  // message
            onConfirm,              // callback to invoke with index of button pressed
            'Un-Friend User',            // title
            'Confirm,Cancel'          // buttonLabels
        );
}
function changeit(page){
window.open(page+".html",'_self');

}
</script>
</head>



<body class="pagewidth">

<div id="pagebg" class="pagewidth"></div>


<div id="page">
       <div id="loading">
        <div id="loaderImage"></div>
       <!-- 
 <script type="text/javascript">
            var cSpeed=7;
            var cWidth=128;
            var cHeight=128;
            var cTotalFrames=30;
            var cFrameWidth=128;
            var cImageSrc='images/43.png';
            var cImageTimeout=false;
            var cIndex=0;
            var cXpos=0;
            var cPreloaderTimeout=false;
            var SECONDS_BETWEEN_FRAMES=0;
            function startAnimation(){
                document.getElementById('loaderImage').style.backgroundImage='url('+cImageSrc+')';
                document.getElementById('loaderImage').style.width=cWidth+'px';
                document.getElementById('loaderImage').style.height=cHeight+'px';
                FPS = Math.round(100/cSpeed);
                SECONDS_BETWEEN_FRAMES = 1 / FPS;
                cPreloaderTimeout=setTimeout('continueAnimation()', SECONDS_BETWEEN_FRAMES/1000);
            }
            function continueAnimation(){
                cXpos += cFrameWidth;
                cIndex += 1;
                if (cIndex >= cTotalFrames) {
                    cXpos =0;
                    cIndex=0;
                }
                if(document.getElementById('loaderImage')){
                    document.getElementById('loaderImage').style.backgroundPosition=(-cXpos)+'px 0';
                    cPreloaderTimeout=setTimeout('continueAnimation()', SECONDS_BETWEEN_FRAMES*1000);
                }
            }
            function stopAnimation(){
                clearTimeout(cPreloaderTimeout);
                cPreloaderTimeout=false;
            }
            function imageLoader(s, fun){
                clearTimeout(cImageTimeout);
                cImageTimeout=0;
                genImage = new Image();
                genImage.onload=function (){
                    cImageTimeout=setTimeout(fun, 0)
                };
                genImage.onerror=new Function('alert(\'Could not load the image\')');
                genImage.src=s;
            }
            new imageLoader(cImageSrc, 'startAnimation()');
        </script>
 -->
 <center>
 <img src="loader2.gif">
 </center>
    </div>
	<div id="home">
		<div id="nav_hdr"><img src="images/header_back.png" class="hdr_back" onclick="changePage(lp);" /><div id="hdr_title">Browse  Profile</div></div>
		
		<div id="tabs" class="font_PNbold">
			<ul id="top_menu">
				<li id="tm_map" onclick="changePage('mapit3');">Map View</li>
				<li id="tm_pro" onclick="changePage('profile-private');">Profile</li>
				<li id="tm_fri" onclick="changePage('friends_list');">Friends</li>
				<li id="tm_home" onclick="changePage('home');">Home</li>
				<li id="tm_mkr" onclick="changePage('checkin2');">X</li>
			</ul>
		</div>
		
		<div class="cnt_clr">
			<table class="pro_browse_motive">
				<tr>
					<td class="photo"><div class="pro_browse_photo_box"><div class="pro_browse_photo"><img src="" /></div></div></td>
					<td class="motive"><div class="motive_paper"><div class="allcaps font_PNbold">Motive:</div><p style="font-size: 30px; -webkit-rtl-ordering: logical;-webkit-user-select: text;-webkit-flex-direction: column;resize: auto;cursor: auto;padding: 2px;white-space: pre-wrap;word-wrap: break-word;"></p></div></td>
				</tr>
			</table>
		</div>
		
		<div class="cnt_clr">
			<table class="pro_browse_buttons">
				<tr>
					<td><div class="button cnct" onclick="">Connect</div></td>
					<td class="spacer"></td>
					<td><div class="button friend" onclick=""></div></td>
					<td class="spacer"></td>
					<td><div class="button map" onclick="localStorage.setItem('mapfocus',pid); changePage('mapit3');">Map</div></td>
					<td class="spacer"></td>
					<td><div class="button block">Block</div></td>
				</tr>
			</table>
		</div>

		<div class="cbox">
			<table class="pro_pub_top">
				
			</table>
			
			<div class="lineshdw"></div>
			<table class="pro_pub_top">
				
			</table>
			
		</div>

		<div class="cbox_title hdr_icon_location">Recent Places</div>
		<div class="cbox">
			<table class="pro_pub_locations private">
		

			</table>
		</div>



<BR />

	</div><!-- end panel -->

</div><!-- end page -->


</body>
</html>